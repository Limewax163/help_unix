### MSMTP

## Почтовый сервис

сервис msmtp по факту отправка почты через командную строку

Шаблон для отправки почты с конфигурацией .msmtprc:

```echo ""test" | /usr/bin/msmtp -C /var/www/.msmtprc -a default test@test.test -t -i```

1 echo "test": Эта часть команды использует команду echo для вывода строки "test" в стандартный вывод. (в нашем случае письмо формируется кодом) Конвейер | перенаправляет этот вывод в следующую часть команды.
2 /usr/bin/msmtp: Путь к исполняемому файлу msmtp
3 -C /var/www/.msmtprc:  Флаг указывает msmtp на файл конфигурации, который содержит настройки для отправки электронной почты
4 -a default: Этот флаг указывает msmtp какой аккаунт отправки электронной почты использовать
5 test@test.test: Это адрес электронной почты получателя
6 -t:  Флаг говорит msmtp интерпретировать письмо, которое будет отправлено, как текстовое сообщение. Это означает, что msmtp не будет ожидать ввода дополнительной информации, такой как заголовки письма.
7 -i: Флаг говорит msmtp игнорировать пробелы в начале строчек текста и не интерпретировать их как инструкции для изменения поведения отправки.


Параметры [mail function] в папке проекта, конфигурационный файл:

www/old-develop.soglasie.ru/docker/app/conf/php.ini
mail function
; For Win32 only.
; http://php.net/smtp
SMTP = 172.17.0.1
; http://php.net/smtp-port
smtp_port = 1025
 
; For Win32 only.
; http://php.net/sendmail-from
;sendmail_from = site@soglasie.ru
 
; For Unix only. You may supply arguments as well (default: "sendmail -t -i").
; http://php.net/sendmail-path
;sendmail_path = /usr/sbin/sendmail -t -i
sendmail_path = /usr/bin/msmtp -C ./.msmtprc -a default -t -i


Весь каталог проекта </www/old-develop.soglasie.ru/> монтируется в контейнер, в директорию /var/www, соответственно заранее подготовленный файл <.msmtprc> который лежит в корне будет смонтирован в контейнер.

В сценарии сборки контейнера app (www/old-develop.sogalsie.ru/docker/app/Dockerfile) одним из последних команд выбирается пользователь www-data и началный каталог /var/www/



В итоге после формировании письма из кода вызывается msmtp, к нему добавляется конфига с настройками отправки.



Для отправки почты файл .msmtprc может содержать конф. информацию, к чему msmtp чувствителен. Для выполнения команды отправки письма необходимо быть владельцем файла .msmtprc и доступ к файлу должен быть ограничен chmod 600

После настройки можно бежать в контейнер docker и прямо из контейнера попытаться отправить письмо шаблоном указанным выше.
